<!DOCTYPE html>
<html lang="en" data-theme="light">
    <%- include('/src/templates/partials/head', {
        title: `Articles tagged "${data.tag.name}" - ${data.main.title}`,
        description: `Browse ${data.tag.count} articles about ${data.tag.name}`,
        canonical: `/tags/${data.tag.slug}.html`
    }) -%>
    <body>
        <div class="layout">
            <%- include('/src/templates/partials/header') -%>
            <main class="container">
                <!-- NO demo showcase section -->

                <!-- Tag intro replaces "Things I'm building" -->
                <section class="intro-section">
                    <p class="label-small-caps">Tagged Articles</p>
                    <h1 class="intro-title">
                        <span class="tag-badge-large"><%= data.tag.name %></span>
                    </h1>
                    <p class="intro-p">
                        <%= data.tag.count %> <%= data.tag.count === 1 ? 'article' : 'articles' %>
                    </p>
                </section>

                <!-- Archive section (same markup as index.ejs) -->
                <section>
                    <header class="section-header">
                        <span class="label-small-caps">Articles</span>
                    </header>
                    <%-
                        data.articles.map(article =>
                            `<article class="article-card">
                                <div class="article-meta">
                                    <time class="article-date">
                                        ${new Date(article.date).toLocaleDateString('en-us', {
                                            timeZone: 'UTC',
                                            weekday:"long",
                                            year:"numeric",
                                            month:"short",
                                            day:"numeric"
                                        })}
                                    </time>
                                    ${article.tagList ? article.tagList.map((tag, idx) =>
                                        `<a href="/tags/${article.tagSlugs[idx]}.html" class="article-tag">${tag}</a>`
                                    ).join('') : ''}
                                </div>
                                <a href="/${article.path}">
                                    <h2 class="article-title">${article.title}</h2>
                                    <p class="article-synopsis">${article.teaser}</p>
                                </a>
                            </article>`
                        ).join('')
                    -%>
                </section>

                <!-- Pagination -->
                <% if (data.totalPages > 1) { %>
                <nav class="pagination">
                    <% if (data.currentPage > 1) { %>
                        <a href="<%= data.currentPage === 2 ? `/tags/${data.tag.slug}.html` : `/tags/${data.tag.slug}-page-${data.currentPage - 1}.html` %>" class="page-link">Previous</a>
                    <% } else { %>
                        <span class="page-link disabled">Previous</span>
                    <% } %>
                    <span class="page-current">Page <%= data.currentPage %> of <%= data.totalPages %></span>
                    <% if (data.currentPage < data.totalPages) { %>
                        <a href="/tags/<%= data.tag.slug %>-page-<%= data.currentPage + 1 %>.html" class="page-link">Next</a>
                    <% } else { %>
                        <span class="page-link disabled">Next</span>
                    <% } %>
                </nav>
                <% } %>

                <%- include('/src/templates/partials/projects', {projects: data.projects}) -%>
                <%- include('/src/templates/partials/social', {author: data.author}) -%>
            </main>
            <%- include('/src/templates/partials/footer') -%>
        </div>
        <script src='/js/main.js'></script>
    </body>
</html>
