<!DOCTYPE html>
<html lang="en">
    <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YJDK7X0K15"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-YJDK7X0K15');
    </script>
    <meta charSet="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="icon" href="/assets/favicon-32x32.png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@100;400;700&display=swap');
    </style>
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="apple-touch-icon" sizes="48x48" href="/assets/icons/icon-48x48.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="/assets/icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/assets/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="256x256" href="/assets/icons/icon-256x256.png">
    <link rel="apple-touch-icon" sizes="384x384" href="/assets/icons/icon-384x384.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/assets/icons/icon-512x512.png">
    <link href="/styles/styles.css" rel="stylesheet" />
    <link href="/styles/prism.css" rel="stylesheet" />
    <script type='module' src='/js/starscape.js'></script>
    <script src='/js/prism.js'></script>
    <title>Simple 2d Terrain With Midpoint Displacement - Somethinghitme</title>
</head>  <body>
    <div class="layout">
        <header class="header">
    <h1><a aria-current="page" href="/">Somethinghitme</a></h1>
    <h2>Code, demos and ideas.</h2>
</header>        <main class="main">
            <section class="primary">
                <article class="blog-post">
                    <header>
                        <h3>Simple 2d Terrain With Midpoint Displacement</h3>
                        <p>
                            Tuesday, Nov 12, 2013                        </p>
                    </header>
                    <section>
                        <p><a href="http://codepen.io/loktar00/details/uEJKl"><img src="/2013/11/11/simple-2d-terrain-with-midpoint-displacement/images/ter.png" alt="Codepen terrain" /></a></p>
<p align="center">
Screenshot from scrolling terrain and shooting stars demo on codepen.io
</p>
<p>In a few of my demos I've used 2d terrain. I love the effect and its really easy to do especially in 2d. The algorithm I use most is Diamond Square also known as Midpoint Displacement. What's great about the algorithm besides its easy of use is that it can be used for simple 2d terrain as well as with 3d terrain. For now I will just be talking about generating 2d terrain, in a future article I will discuss how to use the same algorithm to make create height maps that can be used in turn to create 3d terrain.</p>
<p>Im going to use JavaScript and the canvas element for my examples but the principles can easily be applied to any language or rendering technology.</p>
<p>The method I will be describing is midpoint displacement. Its one of the simplest algorithms in my opinion when it comes to making good looking 2d procedural terrain.</p>
<h2 id="abriefoverviewofhowitworks">A Brief Overview of How it Works</h2>
<p>For Each Segment
    Divide in half and average the middle point
        add a random value to the mid point
        reduce the random range
    Repeat Until segments are too small to continue.</p>
<h2 id="amoreindepthexplanation">A More in Depth Explanation</h2>
<p>First we assign a random value to the outer edges of our terrain. This can be anything from 0-1 or 50-100. The value itself is dependant on the system you want to use for plotting. We then need to get the center point of the segment. Once we have the center we calculate its value by averaging the two points and adding a random value to it.</p>
<p>&nbsp;<a href="http://www.somethinghitme.com/wp-content/uploads/2013/11/fig1.png"><img src="/2013/11/11/simple-2d-terrain-with-midpoint-displacement/images/fig1.png" alt="fig1" /></a></p>
<p>So now that we have our 3 starting points we move onto the next step. The next step is exactly the same as above. As you can see we have 2 segments, so we get the center of each segment and add the average of its edges plus a random amount. We then need reduce our random range for the next iteration.</p>
<p>&nbsp;<a href="http://www.somethinghitme.com/wp-content/uploads/2013/11/fig2.png"><img src="/2013/11/11/simple-2d-terrain-with-midpoint-displacement/images/fig2.png" alt="fig2" /></a></p>
<p>Now we have four segments so all we need to do is cut each segment in half again, average the center values add our random value and reduce the random range.</p>
<p>&nbsp;<a href="http://www.somethinghitme.com/wp-content/uploads/2013/11/fig3.png"><img src="/2013/11/11/simple-2d-terrain-with-midpoint-displacement/images/fig3.png" alt="fig3" /></a></p>
<p>As you can see the more iterations creates more realistic terrain. Lately it seems like none of my articles can be complete without an animated gif, so here is one animating the process.</p>
<p>&nbsp;<a href="http://www.somethinghitme.com/wp-content/uploads/2013/11/output_WRacb0.gif"><img src="/2013/11/11/simple-2d-terrain-with-midpoint-displacement/images/output_WRacb0.gif" alt="output_WRacb0" /></a></p>
<h2 id="howmuchdoireducetherandomrange">How much do I reduce the random range?</h2>
<p>From now on I’ll call this roughness. How much do you need to reduce it by each iteration? Well that all depends on how you want your end result to look. The greater the reduction the less jagged your hill’s will be. So if you want more of a rolling hill appearance you would to reduce the value at least by half every iteration, however if you want more jagged mountains you don’t want to reduce the value very much at all. Below is an example of terrain using two different values for roughness.</p>
<p><a href="http://www.somethinghitme.com/wp-content/uploads/2013/11/point5.png"><img src="/2013/11/11/simple-2d-terrain-with-midpoint-displacement/images/point5.png" alt="point5" /></a> Created by using a value of 0.5</p>
<p><a href="http://www.somethinghitme.com/wp-content/uploads/2013/11/point7.png"><img src="/2013/11/11/simple-2d-terrain-with-midpoint-displacement/images/point7.png" alt="point7" /></a> Created by using a value of 0.7
The following JavaScript function is what I used to create the above examples.</p>
<pre><code class="javascript language-javascript">/*
  width and height are the overall width and height we have to work with, displace is
  the maximum deviation value. This stops the terrain from going out of bounds if we choose
*/

function terrain(width, height, displace, roughness){
    var points = [],
        // Gives us a power of 2 based on our width
        power = Math.pow(2, Math.ceil(Math.log(width) / (Math.log(2))));

    // Set the initial left point
    points[0] = height/2 + (Math.random()*displace*2) - displace;
    // set the initial right point
    points[power] = height/2 + (Math.random()*displace*2) - displace;
    displace *= roughness;

    // Increase the number of segments
    for(var i = 1; i &lt; power; i *=2){
        // Iterate through each segment calculating the center point
        for(var j = (power/i)/2; j &lt; power; j+= power/i){
            points[j] = ((points[j - (power / i) / 2] + points[j + (power / i) / 2]) / 2);
            points[j] += (Math.random()*displace*2) - displace
        }
        // reduce our random range
        displace *= roughness;
    }
    return points;
</code></pre>
<iframe style="width: 540px; height: 300px;" src="https://jsfiddle.net/loktar/5Xdzg/embedded/result,js,html,css/" height="240" width="320" frameborder="0"></iframe>
<p>In my code I also use a value called displace. This is just to control the maximum distance a point can go this is so II can keep it inside of the canvas area.</p>
<h2 id="wrappingterrainandscrolling">Wrapping Terrain and Scrolling</h2>
<p>Using this algorithm makes it easy to create wrapping terrain, in order to do so you just set the two initial starting points to the same value.</p>
<p>There are a few ways to create scrolling terrain. In my codepen for example I cheat and just pop and push the points on the array itself which makes the wrapped terrain scroll. However a better approach in my opinion is to use two sets of values and just move them based on an offset. Once the second half reaches the edge of the screen reset the offset to 0 copy the second array to the first, and generate new terrain for the second array, passing in the seed. Below is a fiddle of how I personally achieve the effect.</p>
<iframe style="width: 540px; height: 300px;" src="https://jsfiddle.net/loktar/XDpd3/embedded/result,js,html,css/" height="240" width="320" frameborder="0"></iframe>
<p>Well that was a lot of information. Would you believe there is an even simpler method to creating 2d terrain than that? I'll go over that in my next article.</p>                    </section>
                    <hr/>
                    <footer>
                                            </footer>
                </article>
                <nav class="nav">
    <ul>
        <li><a class="link-button" rel="prev" href="/2013/11/13/snippets-i-always-forget-movement/">← Game Dev Movement cheatsheet with examples</a></li>        <li><a class="link-button" rel="prev" href="/2013/11/07/burn-away-effect-explanation/">Burn Away Effect Explanation →</a></li>    </ul>
</nav>            </section>
            <section class="secondary">
                <aside class="aside-list">
            <h3>Find Me</h3>
            <ol>
                <li><a href="https://twitter.com/loktar00">@loktar00</a></li><li><a href="https://codepen.io/loktar00">Codepen</a></li><li><a href="https://github.com/loktar00">Github</a></li><li><a href="https://stackoverflow.com/users/322395/loktar">Stackoverflow</a></li><li><a href="https://www.dwitter.net/u/loktar">Dwitter</a></li>
            </ol>
        </aside><aside class="aside-list">
            <h3>Projects</h3>
            <ol>
                <li><a href="https://github.com/loktar00/react-lazy-load">react-lazy-load</a></li><li><a href="https://catbrownrealtor.com/">Cat Brown Realtor</a></li><li><a href="https://github.com/loktar00/jest">Jest Game Framework</a></li><li><a href="https://codegolf.stackexchange.com/questions/30322/make-it-look-like-im-working/30335#30335">gui hacker</a></li><li><a href="https://github.com/loktar00/JQuery-Snowfall">jQuery Snowfall</a></li><li><a href="http://www.retroships.com/">RetroShips</a></li><li><a href="https://zombiegames.net/">Zombiegames.net</a></li>
            </ol>
        </aside>            </section>
        </main>
        <footer class="footer">
    © 2023, Built by <a href="https://github.com/loktar00">Loktar</a>
</footer>    </div>
  </body>